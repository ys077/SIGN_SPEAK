<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignSpeak - AI-Powered Sign Language Translation</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #7209b7;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7ff;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: var(--gradient);
            color: white;
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo-icon {
            font-size: 1.8rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }

        nav a:hover {
            opacity: 0.8;
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.6rem 1.5rem;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background: white;
            color: var(--primary);
        }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Hero Section */
        .hero {
            padding: 4rem 0;
            background: var(--gradient);
            color: white;
            text-align: center;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 800;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            opacity: 0.9;
        }

        .hero-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        /* Features Section */
        .features {
            padding: 5rem 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-title h2 {
            font-size: 2.5rem;
            color: var(--secondary);
            margin-bottom: 1rem;
        }

        .section-title p {
            color: var(--gray);
            max-width: 600px;
            margin: 0 auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .feature-card {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .feature-card h3 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--secondary);
        }

        /* Translation Section */
        .translation-section {
            padding: 5rem 0;
            background: white;
        }

        .translation-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
        }

        .camera-container {
            background: var(--light);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            text-align: center;
        }

        #camera-feed {
            width: 100%;
            max-width: 500px;
            height: auto;
            border-radius: var(--radius);
            background: var(--dark);
            margin-bottom: 1rem;
        }

        .camera-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .translation-output {
            background: var(--light);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .translation-text {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: var(--radius);
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .confidence-meter {
            margin-top: 1rem;
        }

        .meter-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .meter-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }

        .meter-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Dashboard Section */
        .dashboard-section {
            padding: 5rem 0;
            background: var(--light);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .activity-table {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            color: var(--secondary);
            font-weight: 600;
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 3rem 0 1rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-column h3 {
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column li {
            margin-bottom: 0.8rem;
        }

        .footer-column a {
            color: #adb5bd;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-column a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid #495057;
            color: #adb5bd;
            font-size: 0.9rem;
        }

        /* Auth Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal h2 {
            margin-bottom: 1.5rem;
            color: var(--secondary);
            text-align: center;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid #ced4da;
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-footer {
            text-align: center;
            margin-top: 1.5rem;
        }

        .form-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                gap: 1rem;
            }

            .hero h1 {
                font-size: 2.2rem;
            }

            .translation-container {
                grid-template-columns: 1fr;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <span class="logo-icon">üëê</span>
                <span>SignSpeak</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#features">Features</a></li>
                    <li><a href="#translation">Translation</a></li>
                    <li><a href="#dashboard">Dashboard</a></li>
                    <li><a href="#about">About</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <button class="btn btn-outline" id="login-btn">Login</button>
                <button class="btn btn-primary" id="register-btn">Register</button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Bridge Communication Gaps with AI</h1>
            <p>SignSpeak translates sign language to text in real-time using cutting-edge AI technology, making communication accessible for everyone.</p>
            <div class="hero-buttons">
                <button class="btn btn-primary" id="try-now-btn">Try Now</button>
                <button class="btn btn-outline">Learn More</button>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features" id="features">
        <div class="container">
            <div class="section-title">
                <h2>Revolutionary Features</h2>
                <p>SignSpeak combines advanced AI with intuitive design to deliver the most accurate sign language translation platform.</p>
            </div>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üëê</div>
                    <h3>Advanced Hand Gesture Recognition</h3>
                    <p>Real-time MediaPipe integration with 21-point hand landmark detection for precise tracking of finger joints and palm positions.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîí</div>
                    <h3>Intelligent User Authentication</h3>
                    <p>Secure registration and login with encrypted user accounts and personalized dashboards with gesture history.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìπ</div>
                    <h3>Enhanced Camera Interface</h3>
                    <p>Live video feed with visual hand landmarks and gesture stability detection for smooth translations.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîÑ</div>
                    <h3>Smart Translation Engine</h3>
                    <p>Anti-glitch technology with smooth transitions and context-aware translations for multiple sign languages.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3>AI-Powered Learning System</h3>
                    <p>Machine learning model that improves with usage and adaptive confidence scoring based on user patterns.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üåê</div>
                    <h3>Multi-User Collaboration</h3>
                    <p>Real-time chat translation and group session support for multiple users in a single translation session.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Translation Section -->
    <section class="translation-section" id="translation">
        <div class="container">
            <div class="section-title">
                <h2>Real-Time Translation</h2>
                <p>Experience the power of AI sign language translation with our advanced camera interface.</p>
            </div>
            <div class="translation-container">
                <div class="camera-container">
                    <video id="camera-feed" width="640" height="480" autoplay></video>
                    <canvas id="output-canvas" width="640" height="480" style="display: none;"></canvas>
                    <div class="camera-status" id="camera-status">Camera is off</div>
                    <div class="camera-controls">
                        <button class="btn btn-primary" id="start-camera">Start Camera</button>
                        <button class="btn btn-outline" id="stop-camera" disabled>Stop Camera</button>
                    </div>
                </div>
                <div class="translation-output">
                    <div class="translation-text" id="translation-text">
                        Start camera to begin translation
                    </div>
                    <div class="confidence-meter">
                        <div class="meter-label">
                            <span>Confidence Level</span>
                            <span id="confidence-value">0%</span>
                        </div>
                        <div class="meter-bar">
                            <div class="meter-fill" id="confidence-bar"></div>
                        </div>
                    </div>
                    <div class="gesture-info" id="gesture-info" style="margin-top: 1rem; text-align: center;">
                        No gesture detected
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section class="dashboard-section" id="dashboard">
        <div class="container">
            <div class="section-title">
                <h2>User Dashboard</h2>
                <p>Track your translation activity and improve your sign language skills.</p>
            </div>
            <div id="dashboard-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-translations">0</div>
                        <div class="stat-label">Total Translations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="accuracy-rate">0%</div>
                        <div class="stat-label">Accuracy Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="session-time">0 min</div>
                        <div class="stat-label">Session Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="gestures-learned">0</div>
                        <div class="stat-label">Gestures Learned</div>
                    </div>
                </div>
                <div class="activity-table">
                    <h3>Recent Activity</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Gesture</th>
                                <th>Translation</th>
                                <th>Confidence</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="activity-table-body">
                            <tr>
                                <td colspan="4" style="text-align: center;">Please login to view your activity</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="dashboard-login-prompt" class="hidden" style="text-align: center; padding: 3rem;">
                <h3>Please login to access your dashboard</h3>
                <p>Sign in to track your translation progress and view your activity history.</p>
                <button class="btn btn-primary" id="dashboard-login-btn" style="margin-top: 1rem;">Login Now</button>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="about">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>SignSpeak</h3>
                    <p>Bridging communication gaps with AI-powered sign language translation.</p>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#features">Features</a></li>
                        <li><a href="#translation">Translation</a></li>
                        <li><a href="#dashboard">Dashboard</a></li>
                        <li><a href="#about">About Us</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="#">Documentation</a></li>
                        <li><a href="#">API Reference</a></li>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Community</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact</h3>
                    <ul>
                        <li><a href="mailto:info@signspeak.com">info@signspeak.com</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                &copy; 2023 SignSpeak. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <button class="close-modal" id="close-login">&times;</button>
            <h2>Login to SignSpeak</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                <div class="form-footer">
                    <p>Don't have an account? <a href="#" id="show-register">Register</a></p>
                </div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <button class="close-modal" id="close-register">&times;</button>
            <h2>Create an Account</h2>
            <form id="register-form">
                <div class="form-group">
                    <label for="register-name">Full Name</label>
                    <input type="text" id="register-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="register-confirm">Confirm Password</label>
                    <input type="password" id="register-confirm" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Register</button>
                <div class="form-footer">
                    <p>Already have an account? <a href="#" id="show-login">Login</a></p>
                </div>
            </form>
        </div>
    </div>

    <script>
        // DOM Elements
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const loginModal = document.getElementById('login-modal');
        const registerModal = document.getElementById('register-modal');
        const closeLogin = document.getElementById('close-login');
        const closeRegister = document.getElementById('close-register');
        const showRegister = document.getElementById('show-register');
        const showLogin = document.getElementById('show-login');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const tryNowBtn = document.getElementById('try-now-btn');
        const startCameraBtn = document.getElementById('start-camera');
        const stopCameraBtn = document.getElementById('stop-camera');
        const cameraStatus = document.getElementById('camera-status');
        const translationText = document.getElementById('translation-text');
        const confidenceValue = document.getElementById('confidence-value');
        const confidenceBar = document.getElementById('confidence-bar');
        const gestureInfo = document.getElementById('gesture-info');
        const totalTranslations = document.getElementById('total-translations');
        const accuracyRate = document.getElementById('accuracy-rate');
        const sessionTime = document.getElementById('session-time');
        const gesturesLearned = document.getElementById('gestures-learned');
        const activityTableBody = document.getElementById('activity-table-body');
        const dashboardContent = document.getElementById('dashboard-content');
        const dashboardLoginPrompt = document.getElementById('dashboard-login-prompt');
        const dashboardLoginBtn = document.getElementById('dashboard-login-btn');
        const videoElement = document.getElementById('camera-feed');
        const canvasElement = document.getElementById('output-canvas');
        const canvasCtx = canvasElement.getContext('2d');

        // State variables
        let isCameraActive = false;
        let camera = null;
        let hands = null;
        let translationCount = 0;
        let sessionStartTime = null;
        let sessionTimer = null;
        let userData = null;
        let currentGesture = '';
        let gestureStabilityCounter = 0;
        const STABILITY_THRESHOLD = 5;

        // API Configuration
        const API_BASE = 'https://sign7speak.onrender.com/api'; // Replace with your actual backend URL

        // Initialize the app
        function initApp() {
            // Check if user is logged in
            const token = localStorage.getItem('signspeak_token');
            if (token) {
                // Verify token with backend
                verifyToken(token);
            } else {
                updateAuthButtons(false);
                showDashboardLoginPrompt();
            }

            // Set up event listeners
            setupEventListeners();
            
            // Initialize MediaPipe Hands
            initializeHandDetection();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Auth modal controls
            loginBtn.addEventListener('click', () => loginModal.style.display = 'flex');
            registerBtn.addEventListener('click', () => registerModal.style.display = 'flex');
            closeLogin.addEventListener('click', () => loginModal.style.display = 'none');
            closeRegister.addEventListener('click', () => registerModal.style.display = 'none');
            showRegister.addEventListener('click', (e) => {
                e.preventDefault();
                loginModal.style.display = 'none';
                registerModal.style.display = 'flex';
            });
            showLogin.addEventListener('click', (e) => {
                e.preventDefault();
                registerModal.style.display = 'none';
                loginModal.style.display = 'flex';
            });
            dashboardLoginBtn.addEventListener('click', () => loginModal.style.display = 'flex');
            
            // Form submissions
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            
            // Camera controls
            tryNowBtn.addEventListener('click', () => {
                document.getElementById('translation').scrollIntoView({ behavior: 'smooth' });
            });
            
            startCameraBtn.addEventListener('click', startCamera);
            stopCameraBtn.addEventListener('click', stopCamera);
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === loginModal) loginModal.style.display = 'none';
                if (e.target === registerModal) registerModal.style.display = 'none';
            });
        }

        // API Functions
        async function apiCall(endpoint, method = 'GET', data = null) {
            const token = localStorage.getItem('signspeak_token');
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                },
            };

            if (token) {
                options.headers.Authorization = `Bearer ${token}`;
            }

            if (data) {
                options.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.message || 'API request failed');
                }
                
                return result;
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }

        // Verify token with backend
        async function verifyToken(token) {
            try {
                const result = await apiCall('/auth/verify', 'POST', { token });
                userData = result.user;
                updateAuthButtons(true);
                updateDashboard();
                hideDashboardLoginPrompt();
            } catch (error) {
                console.error('Token verification failed:', error);
                localStorage.removeItem('signspeak_token');
                updateAuthButtons(false);
                showDashboardLoginPrompt();
            }
        }

        // Handle login form submission
        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                const result = await apiCall('/auth/login', 'POST', { email, password });
                
                // Store token and user data
                localStorage.setItem('signspeak_token', result.token);
                userData = result.user;
                
                updateAuthButtons(true);
                updateDashboard();
                hideDashboardLoginPrompt();
                loginModal.style.display = 'none';
                
                // Show success message
                alert('Login successful!');
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        }

        // Handle register form submission
        async function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm').value;
            
            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }
            
            try {
                const result = await apiCall('/auth/register', 'POST', { name, email, password });
                
                // Store token and user data
                localStorage.setItem('signspeak_token', result.token);
                userData = result.user;
                
                updateAuthButtons(true);
                updateDashboard();
                hideDashboardLoginPrompt();
                registerModal.style.display = 'none';
                
                // Show success message
                alert('Registration successful!');
            } catch (error) {
                alert('Registration failed: ' + error.message);
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('signspeak_token');
            userData = null;
            updateAuthButtons(false);
            showDashboardLoginPrompt();
            stopCamera(); // Stop camera if running
        }

        // Update auth buttons based on login state
        function updateAuthButtons(isLoggedIn) {
            if (isLoggedIn) {
                loginBtn.textContent = 'Dashboard';
                registerBtn.textContent = 'Logout';
                
                // Update logout functionality
                registerBtn.onclick = logout;
                loginBtn.onclick = () => {
                    document.getElementById('dashboard').scrollIntoView({ behavior: 'smooth' });
                };
            } else {
                loginBtn.textContent = 'Login';
                registerBtn.textContent = 'Register';
                
                // Reset to original functionality
                loginBtn.onclick = () => loginModal.style.display = 'flex';
                registerBtn.onclick = () => registerModal.style.display = 'flex';
            }
        }

        // Show/hide dashboard login prompt
        function showDashboardLoginPrompt() {
            dashboardContent.classList.add('hidden');
            dashboardLoginPrompt.classList.remove('hidden');
        }

        function hideDashboardLoginPrompt() {
            dashboardContent.classList.remove('hidden');
            dashboardLoginPrompt.classList.add('hidden');
        }

        // Update dashboard with user data
        async function updateDashboard() {
            if (userData) {
                try {
                    // Fetch user stats from backend
                    const stats = await apiCall('/user/stats');
                    
                    totalTranslations.textContent = stats.totalTranslations.toLocaleString();
                    accuracyRate.textContent = `${Math.round(stats.accuracyRate * 100)}%`;
                    sessionTime.textContent = `${stats.sessionTime} min`;
                    gesturesLearned.textContent = stats.gesturesLearned;
                    
                    // Fetch recent activity
                    const activity = await apiCall('/user/activity');
                    
                    // Update activity table
                    activityTableBody.innerHTML = '';
                    activity.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.gesture}</td>
                            <td>${item.translation}</td>
                            <td>${Math.round(item.confidence * 100)}%</td>
                            <td>${new Date(item.timestamp).toLocaleString()}</td>
                        `;
                        activityTableBody.appendChild(row);
                    });
                } catch (error) {
                    console.error('Failed to fetch dashboard data:', error);
                }
            }
        }

        // Initialize MediaPipe Hands
        function initializeHandDetection() {
            hands = new Hands({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                }
            });

            hands.setOptions({
                maxNumHands: 2,
                modelComplexity: 1,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });

            hands.onResults(onHandResults);
        }

        // Process hand detection results
        function onHandResults(results) {
            if (!isCameraActive) return;

            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
            
            if (results.multiHandLandmarks) {
                for (const landmarks of results.multiHandLandmarks) {
                    drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {
                        color: '#00FF00',
                        lineWidth: 5
                    });
                    drawLandmarks(canvasCtx, landmarks, {
                        color: '#FF0000',
                        lineWidth: 2
                    });
                }

                // Detect gesture from landmarks
                if (results.multiHandLandmarks.length > 0) {
                    detectGesture(results.multiHandLandmarks[0]);
                }
            }
            
            canvasCtx.restore();
        }

        // Detect gesture from hand landmarks
        function detectGesture(landmarks) {
            // Simplified gesture detection for demo
            // In a real implementation, this would use more complex algorithms
            
            const fingerStates = getFingerStates(landmarks);
            const gesture = classifyGesture(fingerStates);
            const confidence = calculateConfidence(gesture, fingerStates);
            
            // Apply stability check
            if (gesture === currentGesture) {
                gestureStabilityCounter++;
            } else {
                gestureStabilityCounter = 0;
                currentGesture = gesture;
            }
            
            // Only update if gesture is stable
            if (gestureStabilityCounter >= STABILITY_THRESHOLD && confidence > 0.7) {
                updateTranslation(gesture, confidence);
                
                // Log gesture to backend if user is logged in
                if (userData) {
                    logGesture(gesture, confidence);
                }
            }
        }

        // Get finger states from landmarks
        function getFingerStates(landmarks) {
            // Simplified finger state detection
            // This would be more complex in a real implementation
            return {
                thumb: landmarks[4].y < landmarks[3].y,
                index: landmarks[8].y < landmarks[6].y,
                middle: landmarks[12].y < landmarks[10].y,
                ring: landmarks[16].y < landmarks[14].y,
                pinky: landmarks[20].y < landmarks[18].y
            };
        }

        // Classify gesture based on finger states
        function classifyGesture(fingerStates) {
            // Simplified gesture classification
            if (fingerStates.thumb && !fingerStates.index && !fingerStates.middle && !fingerStates.ring && !fingerStates.pinky) {
                return 'Thumbs Up';
            } else if (!fingerStates.thumb && fingerStates.index && fingerStates.middle && !fingerStates.ring && !fingerStates.pinky) {
                return 'Peace';
            } else if (!fingerStates.thumb && fingerStates.index && !fingerStates.middle && !fingerStates.ring && !fingerStates.pinky) {
                return 'Pointing';
            } else if (fingerStates.thumb && fingerStates.index && fingerStates.middle && fingerStates.ring && fingerStates.pinky) {
                return 'Open Hand';
            } else if (!fingerStates.thumb && !fingerStates.index && !fingerStates.middle && !fingerStates.ring && !fingerStates.pinky) {
                return 'Closed Fist';
            } else if (fingerStates.thumb && fingerStates.index && !fingerStates.middle && !fingerStates.ring && !fingerStates.pinky) {
                return 'OK';
            } else {
                return 'Unknown';
            }
        }

        // Calculate confidence for gesture
        function calculateConfidence(gesture, fingerStates) {
            // Simplified confidence calculation
            // This would be more sophisticated in a real implementation
            let confidence = 0.8;
            
            // Adjust confidence based on specific gesture characteristics
            switch (gesture) {
                case 'Thumbs Up':
                    if (fingerStates.thumb && !fingerStates.index && !fingerStates.middle && !fingerStates.ring && !fingerStates.pinky) {
                        confidence = 0.95;
                    }
                    break;
                case 'Peace':
                    if (!fingerStates.thumb && fingerStates.index && fingerStates.middle && !fingerStates.ring && !fingerStates.pinky) {
                        confidence = 0.9;
                    }
                    break;
                case 'Pointing':
                    if (!fingerStates.thumb && fingerStates.index && !fingerStates.middle && !fingerStates.ring && !fingerStates.pinky) {
                        confidence = 0.85;
                    }
                    break;
                case 'Open Hand':
                    if (fingerStates.thumb && fingerStates.index && fingerStates.middle && fingerStates.ring && fingerStates.pinky) {
                        confidence = 0.92;
                    }
                    break;
                case 'Closed Fist':
                    if (!fingerStates.thumb && !fingerStates.index && !fingerStates.middle && !fingerStates.ring && !fingerStates.pinky) {
                        confidence = 0.89;
                    }
                    break;
                case 'OK':
                    if (fingerStates.thumb && fingerStates.index && !fingerStates.middle && !fingerStates.ring && !fingerStates.pinky) {
                        confidence = 0.91;
                    }
                    break;
                default:
                    confidence = 0.5;
            }
            
            return confidence;
        }

        // Update translation display
        function updateTranslation(gesture, confidence) {
            const translationMap = {
                'Thumbs Up': 'Good job!',
                'Peace': 'Peace',
                'Pointing': 'Look there',
                'Open Hand': 'Hello',
                'Closed Fist': 'Stop',
                'OK': 'Okay',
                'Unknown': 'Unknown gesture'
            };
            
            const translation = translationMap[gesture] || 'Unknown gesture';
            
            // Update UI with smooth transition
            translationText.style.opacity = 0;
            setTimeout(() => {
                translationText.textContent = translation;
                translationText.style.opacity = 1;
                
                // Update confidence meter
                const confidencePercent = Math.round(confidence * 100);
                confidenceValue.textContent = `${confidencePercent}%`;
                confidenceBar.style.width = `${confidencePercent}%`;
                
                // Update gesture info
                gestureInfo.textContent = `Detected: ${gesture}`;
                
                // Increment translation count
                translationCount++;
                if (userData) {
                    totalTranslations.textContent = (parseInt(totalTranslations.textContent.replace(/,/g, '')) + 1).toLocaleString();
                }
            }, 300);
        }

        // Log gesture to backend
        async function logGesture(gesture, confidence) {
            try {
                const translationMap = {
                    'Thumbs Up': 'Good job!',
                    'Peace': 'Peace',
                    'Pointing': 'Look there',
                    'Open Hand': 'Hello',
                    'Closed Fist': 'Stop',
                    'OK': 'Okay',
                    'Unknown': 'Unknown gesture'
                };
                
                const translation = translationMap[gesture] || 'Unknown gesture';
                
                await apiCall('/activity/log', 'POST', {
                    gesture,
                    translation,
                    confidence,
                    timestamp: new Date().toISOString()
                });
                
                // Refresh dashboard data
                updateDashboard();
            } catch (error) {
                console.error('Failed to log gesture:', error);
            }
        }

        // Start camera
        async function startCamera() {
            if (isCameraActive) return;
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 640, height: 480 } 
                });
                videoElement.srcObject = stream;
                
                isCameraActive = true;
                cameraStatus.textContent = 'Camera is active - Detecting hands...';
                startCameraBtn.disabled = true;
                stopCameraBtn.disabled = false;
                
                // Start session timer
                sessionStartTime = new Date();
                sessionTimer = setInterval(updateSessionTime, 1000);
                
                // Start processing camera feed with MediaPipe
                camera = new Camera(videoElement, {
                    onFrame: async () => {
                        if (isCameraActive) {
                            await hands.send({ image: videoElement });
                        }
                    },
                    width: 640,
                    height: 480
                });
                camera.start();
                
            } catch (error) {
                console.error('Error starting camera:', error);
                cameraStatus.textContent = 'Error accessing camera';
                alert('Could not access camera. Please make sure you have granted camera permissions.');
            }
        }

        // Stop camera
        function stopCamera() {
            if (!isCameraActive) return;
            
            isCameraActive = false;
            cameraStatus.textContent = 'Camera is off';
            startCameraBtn.disabled = false;
            stopCameraBtn.disabled = true;
            
            // Stop session timer
            clearInterval(sessionTimer);
            
            // Stop camera stream
            if (videoElement.srcObject) {
                videoElement.srcObject.getTracks().forEach(track => track.stop());
                videoElement.srcObject = null;
            }
            
            // Stop MediaPipe camera
            if (camera) {
                camera.stop();
                camera = null;
            }
            
            // Reset translation display
            translationText.textContent = 'Camera stopped';
            confidenceValue.textContent = '0%';
            confidenceBar.style.width = '0%';
            gestureInfo.textContent = 'No gesture detected';
            currentGesture = '';
            gestureStabilityCounter = 0;
        }

        // Update session time display
        function updateSessionTime() {
            if (sessionStartTime) {
                const now = new Date();
                const diffMs = now - sessionStartTime;
                const diffMins = Math.floor(diffMs / 60000);
                if (userData) {
                    sessionTime.textContent = `${diffMins} min`;
                }
            }
        }

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
